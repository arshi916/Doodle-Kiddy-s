<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Doodle Kiddy's Header with Search</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/js/all.min.js"></script>
  <style>
    body {
      font-family: 'Inter', sans-serif;
      background: #f5efe9;
    }
    .beige-gradient {
      background: linear-gradient(to right, #dec7aa, #e5c39f);
    }
    
    /* Search dropdown styles */
    .search-dropdown {
      max-height: 400px;
      overflow-y: auto;
      scrollbar-width: thin;
      scrollbar-color: #c59b68 #f4ebe2;
    }
    
    .search-dropdown::-webkit-scrollbar {
      width: 6px;
    }
    
    .search-dropdown::-webkit-scrollbar-track {
      background: #f4ebe2;
    }
    
    .search-dropdown::-webkit-scrollbar-thumb {
      background: #c59b68;
      border-radius: 3px;
    }
    
    .suggestion-item:hover {
      background: #f4ebe2;
      transform: translateY(-1px);
    }
    
    .suggestion-item {
      transition: all 0.2s ease;
    }
    
    .no-results {
      color: #a67948;
      font-style: italic;
    }
    
    .category-tag {
      background: #e5c39f;
      color: #754c24;
      font-size: 10px;
      padding: 2px 6px;
      border-radius: 8px;
      font-weight: 500;
    }
    
    .product-image {
      width: 40px;
      height: 40px;
      object-fit: cover;
      border-radius: 6px;
    }
    
    .loading-spinner {
      animation: spin 1s linear infinite;
    }
    
    @keyframes spin {
      from { transform: rotate(0deg); }
      to { transform: rotate(360deg); }
    }
  </style>
</head>
<body>
  <header class="sticky top-0 z-50 bg-white shadow-md rounded-b-xl">
    <div class="max-w-7xl mx-auto px-6 py-4">
      <div class="flex items-center justify-between">
      
        <div class="flex items-center space-x-3">
<img src="/images/WhatsApp Image 2025-04-19 at 13.08.27_a46a8f41.jpg" alt="Logo" class="w-10 h-10 rounded-full" />
          <span class="text-lg font-semibold text-[#c59b68]">Doodle Kiddy's</span>
        </div>

        <div class="hidden md:flex items-center justify-center flex-1 max-w-2xl mx-8 relative">
          <div class="relative flex w-full bg-[#fbf8f4] border border-[#e4d7c8] rounded-xl overflow-hidden">
            <input
              id="searchInput"
              type="text"
              placeholder="What are you looking for?"
              class="flex-grow bg-transparent px-4 py-3 text-xs text-gray-700 placeholder-gray-400 focus:outline-none"
              autocomplete="off"
            />
            
            <button id="searchButton" class="px-4 py-3 text-gray-500 hover:text-gray-700 border-l border-[#e4d7c8]">
              <i class="fas fa-search text-sm"></i>
            </button>
          </div>
          
      
          <div id="searchDropdown" class="hidden absolute top-full left-0 right-0 mt-2 bg-white rounded-xl shadow-lg border border-[#e4d7c8] z-50">
            <div id="searchResults" class="search-dropdown">
          
            </div>
          </div>
        </div>

      
        <div class="flex items-center space-x-4">
         
          <div class="relative">
            <button id="userDropdownBtn" class="flex items-center space-x-1 text-[#a67948] hover:text-[#754c24] focus:outline-none">
              <i class="fas fa-user text-sm"></i>
              <span id="userButtonText" class="text-xs font-medium">
                <%= (typeof user !== 'undefined' && user) || (typeof session !== 'undefined' && session.user) ? 'MY ACCOUNT' : 'LOGIN' %>
              </span>
            </button>
            <div id="userDropdownMenu" class="hidden absolute right-0 mt-2 w-40 bg-white rounded-lg shadow-lg ring-1 ring-black ring-opacity-5 z-50">
              <% if ((typeof user !== 'undefined' && user) || (typeof session !== 'undefined' && session.user)) { %>
                <a href="/profile" class="block px-4 py-2 text-xs text-gray-700 hover:bg-[#f4ebe2] rounded-t-lg">
                  <i class="fas fa-user mr-2"></i>Profile
                </a>
                <a href="/orders" class="block px-4 py-2 text-xs text-gray-700 hover:bg-[#f4ebe2]">
                  <i class="fas fa-box mr-2"></i>My Orders
                </a>
                <a href="/logout" class="block px-4 py-2 text-xs text-gray-700 hover:bg-[#f4ebe2] rounded-b-lg">
                  <i class="fas fa-sign-out-alt mr-2"></i>Logout
                </a>
              <% } else { %>
                <a href="/login" class="block px-4 py-2 text-xs text-gray-700 hover:bg-[#f4ebe2] rounded-t-lg">
                  <i class="fas fa-sign-in-alt mr-2"></i>Login
                </a>
                <a href="/signup" class="block px-4 py-2 text-xs text-gray-700 hover:bg-[#f4ebe2] rounded-b-lg">
                  <i class="fas fa-user-plus mr-2"></i>Sign Up
                </a>
              <% } %>
            </div>
          </div>

          
          <button class="flex items-center space-x-1 text-[#a67948] hover:text-[#754c24]">
            <i class="fas fa-heart text-sm"></i>
            <span class="text-xs font-medium">WISHLIST</span>
          </button>

       <a href="/cart" class="flex items-center space-x-1 text-[#a67948] hover:text-[#754c24]">
  <i class="fas fa-shopping-cart text-sm"></i>
  <span class="text-xs font-medium" id="cart-count">
    
    <%= (typeof cart !== 'undefined' && cart.items ? cart.items.reduce((sum, item) => sum + item.quantity, 0) : 0) %>
  </span>
</a>
        </div>
      </div>
    </div>

   
    <div class="border-t border-[#e4d7c8]">
      <div class="max-w-7xl mx-auto px-6">
        <nav class="flex justify-center space-x-12 py-4">
          <a href="/" class="text-xs font-medium text-[#a67948] hover:text-[#754c24] transition-colors">HOME</a>
          <a href="/shop" class="text-xs font-medium text-[#a67948] hover:text-[#754c24] transition-colors">SHOP</a>
          <a href="#" class="text-xs font-medium text-[#a67948] hover:text-[#754c24] transition-colors">NEWS</a>
          <a href="#" class="text-xs font-medium text-[#a67948] hover:text-[#754c24] transition-colors">ABOUT US</a>
          <a href="#" class="text-xs font-medium text-[#a67948] hover:text-[#754c24] transition-colors">CONTACT US</a>
        </nav>
      </div>
    </div>
  </header>


  <script>

    // Add this script to your header partial to ensure cart count updates
document.addEventListener('DOMContentLoaded', function() {
    // Function to update cart count in header
    function updateHeaderCartCount() {
        fetch('/api/cart-count', {
            method: 'GET',
            headers: {
                'Content-Type': 'application/json'
            }
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                // Update all cart count elements in header
                const cartCountElements = document.querySelectorAll('.cart-count, [data-cart-count], .cart-badge');
                cartCountElements.forEach(element => {
                    element.textContent = data.count || 0;
                    
                    // Hide badge if count is 0
                    if (element.classList.contains('cart-badge')) {
                        element.style.display = data.count > 0 ? 'inline-block' : 'none';
                    }
                });
                
                // Update cart link badge specifically
                const cartLink = document.querySelector('a[href="/cart"]');
                if (cartLink) {
                    let badge = cartLink.querySelector('.cart-badge, .badge, span');
                    if (!badge) {
                        badge = document.createElement('span');
                        badge.className = 'cart-badge';
                        badge.style.cssText = `
                            position: absolute;
                            top: -8px;
                            right: -8px;
                            background: #e74c3c;
                            color: white;
                            border-radius: 50%;
                            width: 20px;
                            height: 20px;
                            font-size: 12px;
                            display: flex;
                            align-items: center;
                            justify-content: center;
                            font-weight: bold;
                        `;
                        cartLink.style.position = 'relative';
                        cartLink.appendChild(badge);
                    }
                    badge.textContent = data.count || 0;
                    badge.style.display = data.count > 0 ? 'flex' : 'none';
                }
            }
        })
        .catch(error => {
            console.error('Error fetching cart count:', error);
        });
    }
    
    // Update cart count on page load
    updateHeaderCartCount();
    
    // Update cart count every 30 seconds to keep it in sync
    setInterval(updateHeaderCartCount, 30000);
});
    class SearchManager {
      constructor() {
        this.searchInput = document.getElementById('searchInput');
        this.searchButton = document.getElementById('searchButton');
        this.searchDropdown = document.getElementById('searchDropdown');
        this.searchResults = document.getElementById('searchResults');
        this.userBtn = document.getElementById('userDropdownBtn');
        this.userMenu = document.getElementById('userDropdownMenu');
        
        this.debounceTimer = null;
        this.currentQuery = '';
        this.isLoading = false;
        
        this.init();
      }
      
      init() {
      
        this.searchInput.addEventListener('input', (e) => {
          this.handleSearchInput(e.target.value);
        });
        
        this.searchInput.addEventListener('focus', () => {
          if (this.currentQuery.trim()) {
            this.showDropdown();
          }
        });
        
        
        this.searchButton.addEventListener('click', () => {
          this.performSearch();
        });
        
    
        this.searchInput.addEventListener('keydown', (e) => {
          if (e.key === 'Enter') {
            this.performSearch();
          } else if (e.key === 'Escape') {
            this.hideDropdown();
          }
        });
        
        // User dropdown events
        this.userBtn.addEventListener('click', (e) => {
          e.stopPropagation();
          this.userMenu.classList.toggle('hidden');
        });
        
        // Click outside to close dropdowns
        document.addEventListener('click', (e) => {
          if (!e.target.closest('.relative')) {
            this.hideDropdown();
            this.userMenu.classList.add('hidden');
          }
        });
      }
      
      handleSearchInput(value) {
        const query = value.trim();
        this.currentQuery = query;
        
        // Clear previous timer
        if (this.debounceTimer) {
          clearTimeout(this.debounceTimer);
        }
        
        if (query.length === 0) {
          this.hideDropdown();
          return;
        }
        
        // Debounce search requests
        this.debounceTimer = setTimeout(() => {
          this.fetchSuggestions(query);
        }, 300);
      }
      
      async fetchSuggestions(query) {
        if (this.isLoading) return;
        
        this.isLoading = true;
        this.showLoadingState();
        
        try {
          const response = await fetch(`/api/search-suggestions?q=${encodeURIComponent(query)}`);
          const suggestions = await response.json();
          
          // Only update if this is still the current query
          if (query === this.currentQuery) {
            this.displaySuggestions(suggestions);
          }
        } catch (error) {
          console.error('Error fetching suggestions:', error);
          this.showErrorState();
        } finally {
          this.isLoading = false;
        }
      }
      
      showLoadingState() {
        this.searchResults.innerHTML = `
          <div class="p-4 text-center">
            <i class="fas fa-spinner loading-spinner text-[#c59b68] text-lg"></i>
            <p class="text-xs text-gray-500 mt-2">Searching...</p>
          </div>
        `;
        this.showDropdown();
      }
      
      showErrorState() {
        this.searchResults.innerHTML = `
          <div class="p-4 text-center">
            <i class="fas fa-exclamation-triangle text-red-400 text-lg"></i>
            <p class="text-xs text-red-500 mt-2">Search temporarily unavailable</p>
          </div>
        `;
      }
      
      displaySuggestions(suggestions) {
        if (!suggestions || suggestions.length === 0) {
          this.searchResults.innerHTML = `
            <div class="p-4 text-center no-results">
              <i class="fas fa-search text-2xl mb-2"></i>
              <p class="text-xs">No results found for "${this.currentQuery}"</p>
              <p class="text-xs mt-1 opacity-75">Try a different search term</p>
            </div>
          `;
          this.showDropdown();
          return;
        }
        
        const groupedSuggestions = this.groupSuggestions(suggestions);
        let html = '';
        
        // Categories section
        if (groupedSuggestions.categories.length > 0) {
          html += `
            <div class="border-b border-[#f4ebe2]">
              <h3 class="px-4 py-2 text-xs font-semibold text-[#754c24] bg-[#fbf8f4]">
                <i class="fas fa-tags mr-1"></i> Categories
              </h3>
              ${groupedSuggestions.categories.map(cat => `
                <div class="suggestion-item px-4 py-2 cursor-pointer" onclick="searchManager.selectCategory('${cat.name}')">
                  <div class="flex items-center">
                    <i class="fas fa-folder text-[#c59b68] mr-2"></i>
                    <span class="text-xs text-gray-700">${cat.name}</span>
                  </div>
                </div>
              `).join('')}
            </div>
          `;
        }
        
        // Products section
        if (groupedSuggestions.products.length > 0) {
          html += `
            <div>
              <h3 class="px-4 py-2 text-xs font-semibold text-[#754c24] bg-[#fbf8f4]">
                <i class="fas fa-box mr-1"></i> Products
              </h3>
              ${groupedSuggestions.products.map(product => `
                <div class="suggestion-item px-4 py-3 cursor-pointer border-b border-[#f9f6f1] last:border-b-0" onclick="searchManager.selectProduct('${product._id}')">
                  <div class="flex items-center space-x-3">
                    ${product.image ? `
                      <img src="${product.image}" alt="${product.name}" class="product-image" onerror="this.style.display='none'">
                    ` : `
                      <div class="w-10 h-10 bg-[#f4ebe2] rounded flex items-center justify-center">
                        <i class="fas fa-image text-[#c59b68] text-xs"></i>
                      </div>
                    `}
                    <div class="flex-1 min-w-0">
                      <p class="text-xs font-medium text-gray-800 truncate">${product.name}</p>
                      <div class="flex items-center justify-between mt-1">
                        <span class="category-tag">${product.category}</span>
                        ${product.price ? `<span class="text-xs font-semibold text-[#c59b68]">â‚¹${product.price}</span>` : ''}
                      </div>
                    </div>
                  </div>
                </div>
              `).join('')}
            </div>
          `;
        }
        
        // "See all results" footer
        html += `
          <div class="border-t border-[#f4ebe2] bg-[#fbf8f4]">
            <div class="suggestion-item px-4 py-3 cursor-pointer text-center" onclick="searchManager.performSearch()">
              <i class="fas fa-search text-[#c59b68] mr-2"></i>
              <span class="text-xs font-medium text-[#754c24]">See all results for "${this.currentQuery}"</span>
            </div>
          </div>
        `;
        
        this.searchResults.innerHTML = html;
        this.showDropdown();
      }
      
      groupSuggestions(suggestions) {
        return {
          categories: suggestions.filter(s => s.type === 'category'),
          products: suggestions.filter(s => s.type === 'product')
        };
      }
      
      selectCategory(categoryName) {
        // Navigate to shop page with category filter
        window.location.href = `/shop?category=${encodeURIComponent(categoryName)}`;
      }
      
      selectProduct(productId) {
        // Navigate to product detail page
        window.location.href = `/product/${productId}`;
      }
      
      performSearch() {
        if (this.currentQuery.trim()) {          window.location.href = `/shop?search=${encodeURIComponent(this.currentQuery.trim())}`;
        }
      }
      
      showDropdown() {
        this.searchDropdown.classList.remove('hidden');
      }
      
      hideDropdown() {
        this.searchDropdown.classList.add('hidden');
      }
    }
    
  
    let searchManager;
    document.addEventListener('DOMContentLoaded', () => {
      searchManager = new SearchManager();
    });
  </script>
</body>
</html>