<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Admin - Order Details</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <style>
    body { 
      font-family: 'Inter', sans-serif; 
    }
    .glass-effect {
      backdrop-filter: blur(10px);
      background: rgba(255, 255, 255, 0.95);
    }
    .hover-lift {
      transition: transform 0.2s ease, box-shadow 0.2s ease;
    }
    .hover-lift:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 25px rgba(101, 67, 33, 0.15);
    }
    .fade-in {
      animation: fadeIn 0.5s ease-in;
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .status-badge {
      display: inline-flex;
      align-items: center;
      gap: 0.25rem;
      padding: 0.25rem 0.75rem;
      border-radius: 9999px;
      font-size: 0.75rem;
      font-weight: 500;
    }
    .product-image {
      width: 80px;
      height: 80px;
      object-fit: cover;
      border-radius: 8px;
      border: 2px solid #e5e7eb;
    }
    .timeline-step {
      position: relative;
      padding-left: 2rem;
    }
    .timeline-step::before {
      content: '';
      position: absolute;
      left: 0.5rem;
      top: 1.5rem;
      bottom: -1rem;
      width: 2px;
      background: #e5e7eb;
    }
    .timeline-step:last-child::before {
      display: none;
    }
    .timeline-dot {
      position: absolute;
      left: 0;
      top: 1.25rem;
      width: 1rem;
      height: 1rem;
      border-radius: 50%;
      border: 2px solid #fff;
      box-shadow: 0 0 0 2px #e5e7eb;
    }
    .timeline-dot.active {
      background: #059669;
      box-shadow: 0 0 0 2px #059669;
    }
    .timeline-dot.current {
      background: #3b82f6;
      box-shadow: 0 0 0 2px #3b82f6;
      animation: pulse 2s infinite;
    }
  </style>
</head>
<body class="bg-gradient-to-br from-stone-100 to-amber-50 min-h-screen">

<div class="flex h-screen">
  <!-- Enhanced Sidebar -->
  <aside class="w-64 bg-white shadow-2xl border-r border-stone-300">
    <div class="p-6">
      <div class="flex items-center gap-3">
        <div class="w-8 h-8 bg-gradient-to-r from-stone-600 to-amber-800 rounded-lg flex items-center justify-center">
          <svg class="w-4 h-4 text-white" fill="currentColor" viewBox="0 0 20 20">
            <path d="M3 4a1 1 0 011-1h12a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1V4zM3 10a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H4a1 1 0 01-1-1v-6zM14 9a1 1 0 00-1 1v6a1 1 0 001 1h2a1 1 0 001-1v-6a1 1 0 00-1-1h-2z"/>
          </svg>
        </div>
        <h2 class="text-xl font-bold bg-gradient-to-r from-stone-600 to-amber-800 bg-clip-text text-transparent">AdminHub</h2>
      </div>
    </div>
    
    <nav class="mt-2 px-4 space-y-1">
      <a href="/admin" class="flex items-center gap-3 py-3 px-4 text-gray-700 hover:bg-gradient-to-r hover:from-stone-100 hover:to-amber-50 hover:text-stone-700 rounded-xl transition-all duration-200 group">
        <svg class="w-5 h-5 text-stone-600 group-hover:scale-110 transition-transform" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" d="M3 12l2-2m0 0l7-7 7 7M13 5v6h6" />
        </svg>
        <span class="font-medium">Dashboard</span>
      </a>

      <a href="/admin/customers" class="flex items-center gap-3 py-3 px-4 text-gray-700 hover:bg-gradient-to-r hover:from-stone-100 hover:to-amber-50 hover:text-stone-700 rounded-xl transition-all duration-200 group">
        <svg class="w-5 h-5 text-stone-600 group-hover:scale-110 transition-transform" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197m13.5-9a2.5 2.5 0 11-5 0 2.5 2.5 0 015 0z" />
        </svg>
        <span class="font-medium">Customers</span>
      </a>

      <a href="/admin/products" class="flex items-center gap-3 py-3 px-4 text-gray-700 hover:bg-gradient-to-r hover:from-stone-100 hover:to-amber-50 hover:text-stone-700 rounded-xl transition-all duration-200 group">
        <svg class="w-5 h-5 text-stone-600 group-hover:scale-110 transition-transform" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" d="M20 13V5a2 2 0 00-2-2H6a2 2 0 00-2 2v8m16 0H4m0 0v6a2 2 0 002 2h12a2 2 0 002-2v-6" />
        </svg>
        <span class="font-medium">Products</span>
      </a>

      <a href="/admin/orders" class="flex items-center gap-3 py-3 px-4 bg-gradient-to-r from-stone-200 to-amber-100 text-stone-800 rounded-xl shadow-sm">
        <svg class="w-5 h-5 text-stone-700" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2" />
        </svg>
        <span class="font-semibold">Orders</span>
      </a>

      <a href="/admin/categories" class="flex items-center gap-3 py-3 px-4 text-gray-700 hover:bg-gradient-to-r hover:from-stone-100 hover:to-amber-50 hover:text-stone-700 rounded-xl transition-all duration-200 group">
        <svg class="w-5 h-5 text-stone-600 group-hover:scale-110 transition-transform" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" d="M4 6h16M4 10h16M4 14h16M4 18h16" />
        </svg>
        <span class="font-medium">Categories</span>
      </a>

      <div class="pt-4 mt-4 border-t border-stone-200">
        <a href="/admin/logout" class="flex items-center gap-3 py-3 px-4 text-red-600 hover:bg-red-50 hover:text-red-700 rounded-xl transition-all duration-200 group">
          <svg class="w-5 h-5 text-red-500 group-hover:scale-110 transition-transform" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a1 1 0 01-1 1H5a1 1 0 01-1-1V7a1 1 0 011-1h7a1 1 0 011 1v1" />
          </svg>
          <span class="font-medium">Logout</span>
        </a>
      </div>
    </nav>
  </aside>

  <!-- Main Content -->
  <div class="flex-1 flex flex-col">
    <!-- Enhanced Header -->
    <header class="glass-effect shadow-lg border-b border-stone-300 px-6 py-4">
      <div class="flex justify-between items-center">
        <div class="flex items-center gap-4">
          <a href="/admin/orders" class="inline-flex items-center text-stone-600 hover:text-stone-800 transition-colors">
            <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" d="M15 19l-7-7 7-7" />
            </svg>
            Back to Orders
          </a>
          <div class="w-px h-6 bg-stone-300"></div>
          <h1 class="text-2xl font-bold text-gray-800">Order Details</h1>
          <div class="status-badge bg-stone-200 text-stone-800">
            <div class="w-2 h-2 bg-stone-600 rounded-full animate-pulse"></div>
            #<%= order.orderId %>
          </div>
        </div>
        
        <div class="flex items-center gap-3">
          <button onclick="printOrder()" class="px-4 py-2 bg-gradient-to-r from-stone-600 to-stone-700 text-white rounded-xl hover:from-stone-700 hover:to-stone-800 transition-all duration-200 text-sm font-medium shadow-sm hover:shadow-md">
            <svg class="w-4 h-4 inline mr-2" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" d="M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2z" />
            </svg>
            Print Order
          </button>
        </div>
      </div>
    </header>

    <main class="p-6 overflow-auto flex-1">
      <!-- Order Summary Cards -->
      <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-6">
        <div class="bg-white rounded-2xl shadow-lg border border-stone-200 p-6 hover-lift">
          <div class="flex items-center gap-4">
            <div class="w-12 h-12 bg-gradient-to-r from-blue-500 to-blue-600 rounded-xl flex items-center justify-center">
              <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2" />
              </svg>
            </div>
            <div>
              <p class="text-sm text-gray-600 font-medium">Order ID</p>
              <p class="text-xl font-bold text-gray-800">#<%= order.orderId %></p>
            </div>
          </div>
        </div>

        <div class="bg-white rounded-2xl shadow-lg border border-stone-200 p-6 hover-lift">
          <div class="flex items-center gap-4">
            <div class="w-12 h-12 bg-gradient-to-r from-green-500 to-green-600 rounded-xl flex items-center justify-center">
              <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1" />
              </svg>
            </div>
            <div>
              <p class="text-sm text-gray-600 font-medium">Total Amount</p>
              <p class="text-xl font-bold text-gray-800">₹<%= order.finalAmount %></p>
            </div>
          </div>
        </div>

        <div class="bg-white rounded-2xl shadow-lg border border-stone-200 p-6 hover-lift">
          <div class="flex items-center gap-4">
            <div class="w-12 h-12 bg-gradient-to-r from-purple-500 to-purple-600 rounded-xl flex items-center justify-center">
              <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4" />
              </svg>
            </div>
            <div>
              <p class="text-sm text-gray-600 font-medium">Items</p>
              <p class="text-xl font-bold text-gray-800"><%= order.orderedItemes ? order.orderedItemes.length : 0 %></p>
            </div>
          </div>
        </div>

        <div class="bg-white rounded-2xl shadow-lg border border-stone-200 p-6 hover-lift">
          <div class="flex items-center gap-4">
            <div class="w-12 h-12 bg-gradient-to-r from-amber-500 to-amber-600 rounded-xl flex items-center justify-center">
              <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
              </svg>
            </div>
            <div>
              <p class="text-sm text-gray-600 font-medium">Order Date</p>
              <p class="text-xl font-bold text-gray-800"><%= order.formattedDate %></p>
            </div>
          </div>
        </div>
      </div>

      <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
        <!-- Main Order Details -->
        <div class="lg:col-span-2 space-y-6">
          <!-- Customer Information -->
          <div class="bg-white rounded-2xl shadow-lg border border-stone-200 p-6 hover-lift fade-in">
            <div class="flex items-center justify-between mb-4">
              <h3 class="text-lg font-semibold text-gray-800">Customer Information</h3>
              <div class="w-12 h-12 bg-gradient-to-br from-stone-300 to-amber-400 rounded-xl flex items-center justify-center shadow-md">
                <span class="text-stone-700 font-semibold text-lg">
                  <%= order.address && order.address.name ? order.address.name.charAt(0).toUpperCase() : 'U' %>
                </span>
              </div>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div>
                <p class="text-sm text-gray-600 mb-1">Full Name</p>
                <p class="font-semibold text-gray-800"><%= order.address && order.address.name ? order.address.name : 'N/A' %></p>
              </div>
              <div>
                <p class="text-sm text-gray-600 mb-1">Email</p>
                <p class="font-semibold text-gray-800"><%= order.address && order.address.email ? order.address.email : 'N/A' %></p>
              </div>
              <div>
                <p class="text-sm text-gray-600 mb-1">Phone</p>
                <p class="font-semibold text-gray-800"><%= order.address && order.address.phone ? order.address.phone : 'N/A' %></p>
              </div>
              <div>
                <p class="text-sm text-gray-600 mb-1">User ID</p>
                <p class="font-semibold text-gray-800">#<%= order.address && order.address._id ? order.address._id.toString().slice(-6).toUpperCase() : 'N/A' %></p>
              </div>
            </div>
          </div>

<div class="bg-white rounded-2xl shadow-lg border border-stone-200 p-6 hover-lift fade-in">
  <h3 class="text-lg font-semibold text-gray-800 mb-4 flex items-center gap-2">
    <svg class="w-5 h-5 text-stone-600" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" />
      <path stroke-linecap="round" stroke-linejoin="round" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" />
    </svg>
    Shipping Address
  </h3>
  <div class="bg-stone-50 rounded-xl p-4">
    <p class="font-semibold text-gray-800 mb-2"><%= order.address && order.address.name ? order.address.name : 'N/A' %></p>
    <% if (order.address) { %>
      <% if (order.address.address && typeof order.address.address === 'object') { %>
        <!-- Nested address object -->
        <p class="text-gray-700 mb-1"><%= (order.address.address.houseName || '') + ' ' + (order.address.address.streetAddress || '') %></p>
        <p class="text-gray-700 mb-1"><%= (order.address.address.city || '') + ', ' + (order.address.address.state || '') + ' ' + (order.address.address.pincode || '') %></p>
        <p class="text-gray-700"><%= order.address.address.country || 'India' %></p>
      <% } else { %>
        <!-- Flat address fields or single string -->
        <% if (order.address.houseName || order.address.streetAddress || order.address.city || order.address.state || order.address.pincode) { %>
          <p class="text-gray-700 mb-1"><%= (order.address.houseName || '') + ' ' + (order.address.streetAddress || '') %></p>
          <p class="text-gray-700 mb-1"><%= (order.address.city || '') + ', ' + (order.address.state || '') + ' ' + (order.address.pincode || '') %></p>
          <p class="text-gray-700"><%= order.address.country || 'India' %></p>
        <% } else if (typeof order.address.address === 'string') { %>
          <p class="text-gray-700"><%= order.address.address %></p>
        <% } else { %>
          <p class="text-gray-500">No detailed address available</p>
        <% } %>
      <% } %>
    <% } else { %>
      <p class="text-gray-500">No address available</p>
    <% } %>
  </div>
</div>

          <!-- Order Items -->
          <div class="bg-white rounded-2xl shadow-lg border border-stone-200 p-6 hover-lift fade-in">
            <h3 class="text-lg font-semibold text-gray-800 mb-4">Order Items</h3>
            <div class="space-y-4">
              <% if (order.orderedItemes && order.orderedItemes.length > 0) { %>
                <% order.orderedItemes.forEach(function(item) { %>
                <div class="flex items-center gap-4 p-4 bg-stone-50 rounded-xl">
                  <% 
                  let imageUrl = '/images/placeholder.jpg';
                  if (item.product && item.product.productImage && item.product.productImage.length > 0) {
                    imageUrl = `/images/${item.product.productImage[0]}`;
                  }
                  %>
                  <img src="<%= imageUrl %>" alt="<%= item.product ? item.product.productName : 'Product' %>" class="product-image" 
                       onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iODAiIGhlaWdodD0iODAiIHZpZXdCb3g9IjAgMCA4MCA4MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjgwIiBoZWlnaHQ9IjgwIiBmaWxsPSIjRjNGNEY2Ii8+CjxwYXRoIGQ9Ik00MCA0NkM0My4zMTM3IDQ2IDQ2IDQzLjMxMzcgNDYgNDBDNDYgMzYuNjg2MyA0My4zMTM3IDM0IDQwIDM0QzM2LjY4NjMgMzQgMzQgMzYuNjg2MyAzNCA0MEM0NCA0My4zMTM3IDM2LjY4NjMgNDYgNDAgNDZaIiBmaWxsPSIjOUM5Qzk5Ii8+CjxwYXRoIGQ9Ik0yNi42NjY3IDUySDUzLjMzMzNDNTMuNzAxNSA1MiA1NCA1MS43MDE1IDU0IDUxLjMzMzNWMjguNjY2N0M1NCAyOC4yOTg1IDUzLjcwMTUgMjggNTMuMzMzMyAyOEgyNi42NjY3QzI2LjI5ODUgMjggMjYgMjguMjk4NSAyNiAyOC42NjY3VjUxLjMzMzNDMjYgNTEuNzAxNSAyNi4yOTg1IDUyIDI2LjY2NjcgNTJaIiBzdHJva2U9IiM5QzlDOTkiIHN0cm9rZS13aWR0aD0iMiIvPgo8L3N2Zz4K'">
                  <div class="flex-1">
                    <h4 class="font-semibold text-gray-800 mb-1"><%= item.product ? item.product.productName : 'Product not found' %></h4>
                    <p class="text-sm text-gray-600 mb-2">
                      <% if (item.size) { %>Size: <%= item.size %><% } %>
                      <% if (item.size && item.product && item.product.color && item.product.color.length > 0) { %>, <% } %>
                      <% if (item.product && item.product.color && item.product.color.length > 0) { %>Color: <%= item.product.color[0] %><% } %>
                    </p>
                    <div class="flex items-center gap-4">
                      <span class="text-sm text-gray-600">Qty: <%= item.quantity %></span>
                      <span class="text-sm text-gray-600">₹<%= item.product ? item.product.salePrice : 0 %> each</span>
                      <span class="font-semibold text-gray-800">₹<%= (item.product ? item.product.salePrice : 0) * item.quantity %></span>
                    </div>
                  </div>
                </div>
                <% }); %>
              <% } else { %>
                <div class="text-center py-8 text-gray-500">
                  <svg class="w-12 h-12 text-gray-300 mx-auto mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 13V5a2 2 0 00-2-2H6a2 2 0 00-2 2v8m16 0H4m0 0v6a2 2 0 002 2h12a2 2 0 002-2v-6" />
                  </svg>
                  <p>No items in this order</p>
                </div>
              <% } %>
            </div>

            <!-- Order Summary -->
            <div class="mt-6 pt-4 border-t border-stone-200">
              <div class="space-y-2">
                <div class="flex justify-between text-sm">
                  <span class="text-gray-600">Subtotal:</span>
                  <span class="font-semibold">₹<%= order.totalPrice || 0 %></span>
                </div>
                <% if (order.discount && order.discount > 0) { %>
                <div class="flex justify-between text-sm text-green-600">
                  <span>Discount:</span>
                  <span class="font-semibold">-₹<%= order.discount %></span>
                </div>
                <% } %>
                <div class="flex justify-between text-lg font-bold pt-2 border-t border-stone-200">
                  <span>Total:</span>
                  <span>₹<%= order.finalAmount %></span>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Status & Timeline -->
        <div class="space-y-6">
          <!-- Status Management -->
          <div class="bg-white rounded-2xl shadow-lg border border-stone-200 p-6 hover-lift fade-in">
            <h3 class="text-lg font-semibold text-gray-800 mb-4">Order Status</h3>
            
            <div class="mb-4">
              <% 
              let statusClass = 'bg-gray-100 text-gray-800';
              let dotClass = 'bg-gray-500';
              
              if (order.status === 'Delivered') {
                statusClass = 'bg-green-100 text-green-800';
                dotClass = 'bg-green-500';
              } else if (order.status === 'Pending') {
                statusClass = 'bg-yellow-100 text-yellow-800';
                dotClass = 'bg-yellow-500';
              } else if (order.status === 'Processing') {
                statusClass = 'bg-blue-100 text-blue-800';
                dotClass = 'bg-blue-500';
              } else if (order.status === 'Shipping') {
                statusClass = 'bg-purple-100 text-purple-800';
                dotClass = 'bg-purple-500';
              } else if (order.status === 'Returned' || order.status === 'Return Request') {
                statusClass = 'bg-red-100 text-red-800';
                dotClass = 'bg-red-500';
              }
              %>
              <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium <%= statusClass %>">
                <div class="w-2 h-2 <%= dotClass %> rounded-full mr-2"></div>
                <%= order.status %>
              </span>
            </div>

            <div class="mb-4">
              <label class="block text-sm font-medium text-gray-700 mb-2">Update Status</label>
              <select id="statusSelect" class="w-full p-3 border border-stone-300 rounded-xl focus:ring-2 focus:ring-stone-500 focus:border-transparent">
                <option value="Pending" <%= order.status === 'Pending' ? 'selected' : '' %>>Pending</option>
                <option value="Processing" <%= order.status === 'Processing' ? 'selected' : '' %>>Processing</option>
                <option value="Shipping" <%= order.status === 'Shipping' ? 'selected' : '' %>>Shipping</option>
                <option value="Delivered" <%= order.status === 'Delivered' ? 'selected' : '' %>>Delivered</option>
                <option value="Return Request" <%= order.status === 'Return Request' ? 'selected' : '' %>>Return Request</option>
                <option value="Returned" <%= order.status === 'Returned' ? 'selected' : '' %>>Returned</option>
              </select>
            </div>

            <button onclick="updateOrderStatus()" class="w-full px-4 py-3 bg-gradient-to-r from-stone-600 to-stone-700 text-white rounded-xl hover:from-stone-700 hover:to-stone-800 transition-all duration-200 font-medium shadow-sm hover:shadow-md">
              Update Status
            </button>
          </div>

          <!-- Order Timeline -->
          <div class="bg-white rounded-2xl shadow-lg border border-stone-200 p-6 hover-lift fade-in">
            <h3 class="text-lg font-semibold text-gray-800 mb-4">Order Timeline</h3>
            
            <div class="space-y-4">
              <div class="timeline-step">
                <div class="timeline-dot active"></div>
                <div>
                  <p class="font-semibold text-gray-800">Order Placed</p>
                  <p class="text-sm text-gray-600"><%= order.formattedDate %></p>
                  <p class="text-xs text-gray-500 mt-1">Order confirmed and payment received</p>
                </div>
              </div>

              <div class="timeline-step">
                <div class="timeline-dot <%= order.status === 'Processing' || order.status === 'Shipping' || order.status === 'Delivered' ? 'current' : '' %>"></div>
                <div>
                  <p class="font-semibold <%= order.status === 'Processing' || order.status === 'Shipping' || order.status === 'Delivered' ? 'text-gray-800' : 'text-gray-500' %>">Processing</p>
                  <p class="text-sm <%= order.status === 'Processing' || order.status === 'Shipping' || order.status === 'Delivered' ? 'text-gray-600' : 'text-gray-400' %>">
                    <%= order.status === 'Processing' || order.status === 'Shipping' || order.status === 'Delivered' ? order.formattedDate : 'Pending' %>
                  </p>
                  <p class="text-xs <%= order.status === 'Processing' || order.status === 'Shipping' || order.status === 'Delivered' ? 'text-gray-500' : 'text-gray-400' %> mt-1">Items are being prepared for shipment</p>
                </div>
              </div>

              <div class="timeline-step">
                <div class="timeline-dot <%= order.status === 'Shipping' || order.status === 'Delivered' ? 'current' : '' %>"></div>
                <div>
                  <p class="font-medium <%= order.status === 'Shipping' || order.status === 'Delivered' ? 'text-gray-800' : 'text-gray-500' %>">Shipped</p>
                  <p class="text-sm <%= order.status === 'Shipping' || order.status === 'Delivered' ? 'text-gray-600' : 'text-gray-400' %>">
                    <%= order.status === 'Shipping' || order.status === 'Delivered' ? order.formattedDate : 'Pending' %>
                  </p>
                  <p class="text-xs <%= order.status === 'Shipping' || order.status === 'Delivered' ? 'text-gray-500' : 'text-gray-400' %> mt-1">Items dispatched for delivery</p>
                </div>
              </div>

              <div class="timeline-step">
                <div class="timeline-dot <%= order.status === 'Delivered' ? 'active' : '' %>"></div>
                <div>
                  <p class="font-medium <%= order.status === 'Delivered' ? 'text-gray-800' : 'text-gray-500' %>">Delivered</p>
                  <p class="text-sm <%= order.status === 'Delivered' ? 'text-gray-600' : 'text-gray-400' %>">
                    <%= order.status === 'Delivered' ? (order.invoiceDate || order.formattedDate) : 'Pending' %>
                  </p>
                  <p class="text-xs <%= order.status === 'Delivered' ? 'text-gray-500' : 'text-gray-400' %> mt-1">Package delivered successfully</p>
                </div>
              </div>
            </div>
          </div>

          <!-- Payment Information -->
          <div class="bg-white rounded-2xl shadow-lg border border-stone-200 p-6 hover-lift fade-in">
            <h3 class="text-lg font-semibold text-gray-800 mb-4 flex items-center gap-2">
              <svg class="w-5 h-5 text-stone-600" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z" />
              </svg>
              Payment Details
            </h3>
            <div class="space-y-3">
              <div class="flex justify-between">
                <span class="text-gray-600">Method:</span>
                <span class="font-semibold"><%= order.paymentMethod || 'Not specified' %></span>
              </div>
              <div class="flex justify-between">
                <span class="text-gray-600">Order ID:</span>
                <span class="font-semibold font-mono text-sm">#<%= order.orderId %></span>
              </div>
              <div class="flex justify-between">
                <span class="text-gray-600">Status:</span>
                <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800">
                  <div class="w-1.5 h-1.5 bg-green-500 rounded-full mr-1"></div>
                  Paid
                </span>
              </div>
              <div class="flex justify-between">
                <span class="text-gray-600">Payment Date:</span>
                <span class="font-semibold"><%= order.formattedDate %></span>
              </div>
            </div>
          </div>

          <!-- Quick Actions -->
          <div class="bg-white rounded-2xl shadow-lg border border-stone-200 p-6 hover-lift fade-in">
            <h3 class="text-lg font-semibold text-gray-800 mb-4">Quick Actions</h3>
            <div class="space-y-3">
              <button onclick="sendNotification()" class="w-full flex items-center gap-3 px-4 py-3 text-left border border-stone-300 rounded-xl hover:bg-stone-50 transition-colors">
                <svg class="w-5 h-5 text-stone-600" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M15 17h5l-3.5-3.5a2.828 2.828 0 000-4L18 8a2.828 2.828 0 00-4-4H8a2.828 2.828 0 00-4 4v1.5L6.5 12 4 14.5V16a2.828 2.828 0 004 4h2.5" />
                </svg>
                <div>
                  <p class="font-medium text-gray-800">Send Update</p>
                  <p class="text-sm text-gray-600">Notify customer</p>
                </div>
              </button>

              <button onclick="generateInvoice()" class="w-full flex items-center gap-3 px-4 py-3 text-left border border-stone-300 rounded-xl hover:bg-stone-50 transition-colors">
                <svg class="w-5 h-5 text-stone-600" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                </svg>
                <div>
                  <p class="font-medium text-gray-800">Generate Invoice</p>
                  <p class="text-sm text-gray-600">Download PDF</p>
                </div>
              </button>

              <button onclick="viewCustomer()" class="w-full flex items-center gap-3 px-4 py-3 text-left border border-stone-300 rounded-xl hover:bg-stone-50 transition-colors">
                <svg class="w-5 h-5 text-stone-600" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                </svg>
                <div>
                  <p class="font-medium text-gray-800">View Customer</p>
                  <p class="text-sm text-gray-600">Customer details</p>
                </div>
              </button>
            </div>
          </div>
        </div>
      </div>
    </main>
  </div>
</div>

<script>

    
// Update Order Status Function
async function updateOrderStatus() {
  const statusSelect = document.getElementById('statusSelect');
  const newStatus = statusSelect.value;
  const orderId = '<%= order._id %>'; // Get order ID from EJS
  
  try {
    // Show loading state
    const button = event.target;
    const originalText = button.innerHTML;
    button.innerHTML = `
      <svg class="animate-spin -ml-1 mr-2 h-4 w-4 text-white inline" fill="none" viewBox="0 0 24 24">
        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
      </svg>
      Updating...
    `;
    button.disabled = true;

    const response = await fetch('/admin/orders/update-status', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify({
        orderId: orderId,
        status: newStatus
      })
    });

    const data = await response.json();

    if (data.success) {
      await Swal.fire({
        icon: 'success',
        title: 'Status Updated!',
        text: data.message,
        confirmButtonColor: '#059669',
        customClass: {
          popup: 'rounded-2xl',
          confirmButton: 'rounded-xl'
        }
      });

      // Reload the page to reflect changes
      window.location.reload();
      
    } else {
      throw new Error(data.message || 'Failed to update status');
    }
  } catch (error) {
    console.error('Error updating status:', error);
    await Swal.fire({
      icon: 'error',
      title: 'Update Failed',
      text: error.message || 'Something went wrong while updating the status',
      confirmButtonColor: '#dc2626',
      customClass: {
        popup: 'rounded-2xl',
        confirmButton: 'rounded-xl'
      }
    });
  } finally {
    // Restore button
    const button = document.querySelector('button[onclick="updateOrderStatus()"]');
    button.innerHTML = 'Update Status';
    button.disabled = false;
  }
}

// Print Order Function
function printOrder() {
  window.print();
}

// Send Notification Function
async function sendNotification() {
  await Swal.fire({
    title: 'Send Update Notification',
    html: `
      <div class="text-left space-y-4">
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">Message Template</label>
          <select class="w-full p-3 border border-stone-300 rounded-xl">
            <option>Order status update</option>
            <option>Shipping confirmation</option>
            <option>Delivery notification</option>
            <option>Custom message</option>
          </select>
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">Additional Message</label>
          <textarea class="w-full p-3 border border-stone-300 rounded-xl" rows="3" placeholder="Add a personal message..."></textarea>
        </div>
      </div>
    `,
    showCancelButton: true,
    confirmButtonText: 'Send Notification',
    cancelButtonText: 'Cancel',
    confirmButtonColor: '#059669',
    customClass: {
      popup: 'rounded-2xl',
      confirmButton: 'rounded-xl',
      cancelButton: 'rounded-xl'
    }
  });
}

// Generate Invoice Function
function generateInvoice() {
  Swal.fire({
    icon: 'success',
    title: 'Invoice Generated!',
    text: 'Invoice PDF has been generated and is ready for download.',
    confirmButtonText: 'Download',
    confirmButtonColor: '#059669',
    customClass: {
      popup: 'rounded-2xl',
      confirmButton: 'rounded-xl'
    }
  });
}

// View Customer Function
function viewCustomer() {
  <% if (order.address && order.address._id) { %>
  window.location.href = '/admin/customers/edit/<%= order.address._id %>';
  <% } else { %>
  Swal.fire({
    icon: 'info',
    title: 'Customer Not Found',
    text: 'Customer information is not available for this order.',
    confirmButtonColor: '#3b82f6',
    customClass: {
      popup: 'rounded-2xl',
      confirmButton: 'rounded-xl'
    }
  });
  <% } %>
}

// Initialize page
document.addEventListener('DOMContentLoaded', function() {
  // Add smooth animations
  const cards = document.querySelectorAll('.hover-lift');
  cards.forEach((card, index) => {
    card.style.animationDelay = `${index * 0.1}s`;
  });
  
  // Add hover effects to timeline dots
  const timelineDots = document.querySelectorAll('.timeline-dot');
  timelineDots.forEach(dot => {
    dot.addEventListener('mouseenter', function() {
      if (!this.classList.contains('active') && !this.classList.contains('current')) {
        this.style.transform = 'scale(1.2)';
        this.style.transition = 'transform 0.2s ease';
      }
    });
    
    dot.addEventListener('mouseleave', function() {
      this.style.transform = 'scale(1)';
    });
  });

  // Add loading states to action buttons
  const actionButtons = document.querySelectorAll('button[onclick^="send"], button[onclick^="generate"], button[onclick^="view"]');
  actionButtons.forEach(button => {
    button.addEventListener('click', function() {
      this.style.transform = 'scale(0.95)';
      setTimeout(() => {
        this.style.transform = 'scale(1)';
      }, 150);
    });
  });
});

</script>

</body>
</html>