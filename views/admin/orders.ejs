<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Admin - Orders</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <style>
    body { 
      font-family: 'Inter', sans-serif; 
    }
    .glass-effect {
      backdrop-filter: blur(10px);
      background: rgba(255, 255, 255, 0.95);
    }
    .hover-lift {
      transition: transform 0.2s ease, box-shadow 0.2s ease;
    }
    .hover-lift:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 25px rgba(101, 67, 33, 0.15);
    }
    .fade-in {
      animation: fadeIn 0.5s ease-in;
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .status-badge {
      display: inline-flex;
      align-items: center;
      gap: 0.25rem;
      padding: 0.25rem 0.75rem;
      border-radius: 9999px;
      font-size: 0.75rem;
      font-weight: 500;
    }
    .action-button {
      transition: all 0.2s ease;
    }
    .action-button:hover {
      transform: scale(1.05);
    }
    .table-row:hover {
      background: linear-gradient(to right, rgba(120, 113, 108, 0.05), rgba(251, 191, 36, 0.05));
    }
  </style>
</head>
<body class="bg-gradient-to-br from-stone-100 to-amber-50 min-h-screen">

<div class="flex h-screen">
  <!-- Enhanced Sidebar -->
  <aside class="w-64 bg-white shadow-2xl border-r border-stone-300">
    <div class="p-6">
      <div class="flex items-center gap-3">
        <div class="w-8 h-8 bg-gradient-to-r from-stone-600 to-amber-800 rounded-lg flex items-center justify-center">
          <svg class="w-4 h-4 text-white" fill="currentColor" viewBox="0 0 20 20">
            <path d="M3 4a1 1 0 011-1h12a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1V4zM3 10a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H4a1 1 0 01-1-1v-6zM14 9a1 1 0 00-1 1v6a1 1 0 001 1h2a1 1 0 001-1v-6a1 1 0 00-1-1h-2z"/>
          </svg>
        </div>
        <h2 class="text-xl font-bold bg-gradient-to-r from-stone-600 to-amber-800 bg-clip-text text-transparent">AdminHub</h2>
      </div>
    </div>
    
    <nav class="mt-2 px-4 space-y-1">
      <a href="/admin" class="flex items-center gap-3 py-3 px-4 text-gray-700 hover:bg-gradient-to-r hover:from-stone-100 hover:to-amber-50 hover:text-stone-700 rounded-xl transition-all duration-200 group">
        <svg class="w-5 h-5 text-stone-600 group-hover:scale-110 transition-transform" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" d="M3 12l2-2m0 0l7-7 7 7M13 5v6h6" />
        </svg>
        <span class="font-medium">Dashboard</span>
      </a>

      <a href="/admin/customers" class="flex items-center gap-3 py-3 px-4 text-gray-700 hover:bg-gradient-to-r hover:from-stone-100 hover:to-amber-50 hover:text-stone-700 rounded-xl transition-all duration-200 group">
        <svg class="w-5 h-5 text-stone-600 group-hover:scale-110 transition-transform" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197m13.5-9a2.5 2.5 0 11-5 0 2.5 2.5 0 015 0z" />
        </svg>
        <span class="font-medium">Customers</span>
      </a>

      <a href="/admin/products" class="flex items-center gap-3 py-3 px-4 text-gray-700 hover:bg-gradient-to-r hover:from-stone-100 hover:to-amber-50 hover:text-stone-700 rounded-xl transition-all duration-200 group">
        <svg class="w-5 h-5 text-stone-600 group-hover:scale-110 transition-transform" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" d="M20 13V5a2 2 0 00-2-2H6a2 2 0 00-2 2v8m16 0H4m0 0v6a2 2 0 002 2h12a2 2 0 002-2v-6" />
        </svg>
        <span class="font-medium">Products</span>
      </a>

      <a href="/admin/orders" class="flex items-center gap-3 py-3 px-4 bg-gradient-to-r from-stone-200 to-amber-100 text-stone-800 rounded-xl shadow-sm">
        <svg class="w-5 h-5 text-stone-700" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2" />
        </svg>
        <span class="font-semibold">Orders</span>
      </a>

      <a href="/admin/categories" class="flex items-center gap-3 py-3 px-4 text-gray-700 hover:bg-gradient-to-r hover:from-stone-100 hover:to-amber-50 hover:text-stone-700 rounded-xl transition-all duration-200 group">
        <svg class="w-5 h-5 text-stone-600 group-hover:scale-110 transition-transform" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" d="M4 6h16M4 10h16M4 14h16M4 18h16" />
        </svg>
        <span class="font-medium">Categories</span>
      </a>

      <div class="pt-4 mt-4 border-t border-stone-200">
        <a href="/admin/logout" class="flex items-center gap-3 py-3 px-4 text-red-600 hover:bg-red-50 hover:text-red-700 rounded-xl transition-all duration-200 group">
          <svg class="w-5 h-5 text-red-500 group-hover:scale-110 transition-transform" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a1 1 0 01-1 1H5a1 1 0 01-1-1V7a1 1 0 011-1h7a1 1 0 011 1v1" />
          </svg>
          <span class="font-medium">Logout</span>
        </a>
      </div>
    </nav>
  </aside>

  <!-- Main Content -->
  <div class="flex-1 flex flex-col">
    <!-- Enhanced Header -->
    <header class="glass-effect shadow-lg border-b border-stone-300 px-6 py-4">
      <div class="flex justify-between items-center">
        <div class="flex items-center gap-4">
          <h1 class="text-2xl font-bold text-gray-800">Order Management</h1>
          <div class="status-badge bg-stone-200 text-stone-800">
            <div class="w-2 h-2 bg-stone-600 rounded-full animate-pulse"></div>
            Active
          </div>
        </div>
        
        <div class="flex items-center space-x-4">
          <form method="GET" action="/admin/orders" class="flex items-center space-x-3">
            <div class="relative">
              <input name="search" type="text" placeholder="Search orders..." value="<%= typeof search !== 'undefined' ? search : '' %>"
                     class="pl-10 pr-4 py-2 w-64 border border-stone-400 rounded-xl focus:ring-2 focus:ring-stone-500 focus:border-transparent transition-all duration-200 shadow-sm"/>
              <svg class="absolute left-3 top-2.5 w-4 h-4 text-gray-400" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
              </svg>
            </div>
            
            <button type="submit" class="px-4 py-2 bg-gradient-to-r from-stone-600 to-stone-700 text-white rounded-xl hover:from-stone-700 hover:to-stone-800 transition-all duration-200 text-sm font-medium shadow-sm hover:shadow-md">
              Search
            </button>
          </form>
          
          <button onclick="refreshOrders()" class="px-4 py-2 bg-gradient-to-r from-amber-600 to-amber-700 text-white rounded-xl hover:from-amber-700 hover:to-amber-800 transition-all duration-200 text-sm font-medium shadow-sm hover:shadow-md">
            <svg class="w-4 h-4 inline mr-1" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
            </svg>
            Refresh
          </button>
        </div>
      </div>
    </header>

    <main class="p-6 overflow-x-auto flex-1">
      <!-- Success Message -->
      <% if (typeof successMessage !== 'undefined' && successMessage) { %>
      <div id="successAlert" class="bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded-xl mb-6 fade-in">
        <div class="flex items-center">
          <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
          </svg>
          <span class="font-medium"><%= successMessage %></span>
          <button onclick="closeAlert()" class="ml-auto text-green-500 hover:text-green-700">
            <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"/>
            </svg>
          </button>
        </div>
      </div>
      <% } %>

      <div class="bg-white rounded-2xl shadow-xl border border-stone-300 hover-lift fade-in">
        <!-- Stats Header -->
        <div class="p-6 border-b border-stone-300 bg-gradient-to-r from-stone-100 to-amber-50 rounded-t-2xl">
          <div class="flex items-center justify-between">
            <div class="flex items-center gap-6">
              <div class="bg-gradient-to-r from-stone-600 to-amber-800 p-3 rounded-xl">
                <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2" />
                </svg>
              </div>
              <div>
                <p class="text-sm text-gray-600 font-medium">Total Orders</p>
                <p class="text-3xl font-bold text-gray-800"><%= typeof totalOrders !== 'undefined' ? totalOrders : 0 %></p>
              </div>
            </div>
            
            <!-- Quick Stats -->
            <div class="grid grid-cols-3 gap-4">
              <div class="text-center">
                <p class="text-xs text-gray-500 uppercase tracking-wider">Pending</p>
                <p class="text-lg font-bold text-yellow-600" id="pendingCount">-</p>
              </div>
              <div class="text-center">
                <p class="text-xs text-gray-500 uppercase tracking-wider">Processing</p>
                <p class="text-lg font-bold text-blue-600" id="processingCount">-</p>
              </div>
              <div class="text-center">
                <p class="text-xs text-gray-500 uppercase tracking-wider">Delivered</p>
                <p class="text-lg font-bold text-green-600" id="deliveredCount">-</p>
              </div>
            </div>
          </div>
        </div>

        <!-- Enhanced Table -->
        <div class="overflow-x-auto">
          <table class="w-full">
            <thead class="bg-gradient-to-r from-stone-100 to-amber-50 border-b border-stone-300">
              <tr>
                <th class="px-6 py-4 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider">Order ID</th>
                <th class="px-6 py-4 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider">Customer</th>
                <th class="px-6 py-4 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider">Products</th>
                <th class="px-6 py-4 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider">Amount</th>
                <th class="px-6 py-4 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider">Order Date</th>
                <th class="px-6 py-4 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider">Status</th>
                <th class="px-6 py-4 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider">Actions</th>
              </tr>
            </thead>
            <tbody class="bg-white divide-y divide-stone-200">
              <% if (typeof orders !== 'undefined' && orders && orders.length > 0) { %>
                <% orders.forEach(function(order) { %>
                <tr class="table-row transition-colors duration-200">
                  <!-- Order ID -->
                  <td class="px-6 py-4 whitespace-nowrap">
                    <span class="inline-flex items-center px-2.5 py-1 rounded-full text-xs font-medium bg-stone-200 text-stone-800 font-mono">
                      #<%= order.orderId %>
                    </span>
                  </td>

                  <!-- Customer -->
                  <td class="px-6 py-4 whitespace-nowrap">
                    <div class="flex items-center gap-4">
                      <div class="w-12 h-12 bg-gradient-to-br from-stone-300 to-amber-400 rounded-xl flex items-center justify-center shadow-md">
                        <span class="text-stone-700 font-semibold text-sm">
                          <%= order.address && order.address.name ? order.address.name.charAt(0).toUpperCase() : 'U' %>
                        </span>
                      </div>
                      <div>
                        <p class="text-sm font-semibold text-gray-900">
                          <%= order.address && order.address.name ? order.address.name : 'Unknown User' %>
                        </p>
                        <p class="text-xs text-gray-500">
                          <%= order.address && order.address.email ? order.address.email : 'No email' %>
                        </p>
                      </div>
                    </div>
                  </td>

                  <!-- Products -->
                  <td class="px-6 py-4">
                    <div class="text-sm text-gray-700">
                      <% if (order.orderedItemes && order.orderedItemes.length > 0) { %>
                        <div class="flex items-center gap-3">
                          <% 
                          let firstProduct = order.orderedItemes[0];
                          let imageUrl = '/images/placeholder.jpg';
                          if (firstProduct.product && firstProduct.product.productImage && firstProduct.product.productImage.length > 0) {
                            imageUrl = `/images/${firstProduct.product.productImage[0]}`;
                          }
                          %>
                          <img src="<%= imageUrl %>" alt="Product" class="w-10 h-10 object-cover rounded-lg border border-stone-200"
                               onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAiIGhlaWdodD0iNDAiIHZpZXdCb3g9IjAgMCA0MCA0MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjQwIiBoZWlnaHQ9IjQwIiBmaWxsPSIjRjNGNEY2Ii8+CjxwYXRoIGQ9Ik0yMCAyM0MyMS42NTY5IDIzIDIzIDIxLjY1NjkgMjMgMjBDMjMgMTguMzQzMSAyMS42NTY5IDE3IDIwIDE3QzE4LjM0MzEgMTcgMTcgMTguMzQzMSAxNyAyMEMxNyAyMS42NTY5IDE4LjM0MzEgMjMgMjAgMjNaIiBmaWxsPSIjOUM5Qzk5Ii8+CjxwYXRoIGQ9Ik0xMy4zMzMzIDI2SDI2LjY2NjdDMjYuODUwNCAyNiAyNyAyNS44NTA0IDI3IDI1LjY2NjdWMTQuMzMzM0MyNyAxNC4xNDk2IDI2Ljg1MDQgMTQgMjYuNjY2NyAxNEgxMy4zMzMzQzEzLjE0OTYgMTQgMTMgMTQuMTQ5NiAxMyAxNC4zMzMzVjI1LjY2NjdDMTMgMjUuODUwNCAxMy4xNDk2IDI2IDEzLjMzMzMgMjZaIiBzdHJva2U9IiM5QzlDOTkiIHN0cm9rZS13aWR0aD0iMSIvPgo8L3N2Zz4K'">
                          <div>
                            <div class="font-medium">
                              <%= firstProduct.product ? firstProduct.product.productName : 'Product not found' %>
                              <% if (order.orderedItemes.length > 1) { %>
                                <span class="text-xs text-gray-500">+<%= order.orderedItemes.length - 1 %> more</span>
                              <% } %>
                            </div>
                            <div class="text-xs text-gray-500">
                              Qty: <%= firstProduct.quantity %>
                            </div>
                          </div>
                        </div>
                      <% } else { %>
                        <div class="font-medium text-gray-400">No products</div>
                      <% } %>
                    </div>
                  </td>

                  <!-- Amount -->
                  <td class="px-6 py-4 whitespace-nowrap">
                    <span class="text-sm font-semibold text-gray-900">₹<%= order.finalAmount %></span>
                    <% if (order.discount && order.discount > 0) { %>
                      <div class="text-xs text-green-600">-₹<%= order.discount %> discount</div>
                    <% } %>
                  </td>

                  <!-- Order Date -->
                  <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                    <%= order.createdOn ? new Date(order.createdOn).toLocaleDateString() : 'N/A' %>
                  </td>

                  <!-- Status -->
                  <td class="px-6 py-4 whitespace-nowrap">
                    <% 
                    let statusClass = 'bg-gray-100 text-gray-800';
                    let dotClass = 'bg-gray-500';
                    
                    if (order.status === 'Delivered') {
                      statusClass = 'bg-green-100 text-green-800';
                      dotClass = 'bg-green-500';
                    } else if (order.status === 'Pending') {
                      statusClass = 'bg-yellow-100 text-yellow-800';
                      dotClass = 'bg-yellow-500';
                    } else if (order.status === 'Processing') {
                      statusClass = 'bg-blue-100 text-blue-800';
                      dotClass = 'bg-blue-500';
                    } else if (order.status === 'Shipping') {
                      statusClass = 'bg-purple-100 text-purple-800';
                      dotClass = 'bg-purple-500';
                    } else if (order.status === 'Returned' || order.status === 'Return Request') {
                      statusClass = 'bg-red-100 text-red-800';
                      dotClass = 'bg-red-500';
                    }
                    %>
                    <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium <%= statusClass %>">
                      <div class="w-2 h-2 <%= dotClass %> rounded-full mr-2"></div>
                      <%= order.status %>
                    </span>
                  </td>

                  <!-- Actions -->
                  <td class="px-6 py-4 whitespace-nowrap">
                    <div class="flex items-center gap-2">
                      <button onclick="viewOrder('<%= order._id %>')" class="action-button inline-flex items-center p-2 text-stone-600 hover:text-stone-700 hover:bg-stone-100 rounded-lg transition-all duration-200" title="View Order Details">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                          <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                          <path stroke-linecap="round" stroke-linejoin="round" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
                        </svg>
                      </button>
                      
                      <button onclick="quickStatusUpdate('<%= order._id %>', '<%= order.status %>')" class="action-button inline-flex items-center p-2 text-amber-600 hover:text-amber-700 hover:bg-amber-100 rounded-lg transition-all duration-200" title="Quick Status Update">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                          <path stroke-linecap="round" stroke-linejoin="round" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
                        </svg>
                      </button>
                    </div>
                  </td>
                </tr>
                <% }); %>
              <% } else { %>
                <tr>
                  <td colspan="7" class="px-6 py-8 text-center text-gray-500">
                    <div class="flex flex-col items-center">
                      <svg class="w-12 h-12 text-gray-300 mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2" />
                      </svg>
                      <p class="text-lg font-medium">No orders found</p>
                      <% if (typeof search !== 'undefined' && search) { %>
                        <p class="text-sm">Try adjusting your search criteria</p>
                        <a href="/admin/orders" class="mt-2 text-stone-600 hover:text-stone-800 text-sm underline">Clear search</a>
                      <% } else { %>
                        <p class="text-sm">Orders will appear here when customers place them</p>
                      <% } %>
                    </div>
                  </td>
                </tr>
              <% } %>
            </tbody>
          </table>
        </div>

        <!-- Enhanced Pagination -->
        <% if (typeof totalPages !== 'undefined' && totalPages > 1) { %>
        <div class="px-6 py-4 border-t border-stone-300 bg-stone-100 rounded-b-2xl">
          <div class="flex items-center justify-between">
            <p class="text-sm text-gray-700">
              Showing page <span class="font-medium"><%= typeof currentPage !== 'undefined' ? currentPage : 1 %></span> of <span class="font-medium"><%= totalPages %></span>
            </p>
            
            <nav class="flex items-center space-x-2">
              <% if (typeof currentPage !== 'undefined' && currentPage > 1) { %>
                <a href="?page=<%= currentPage - 1 %><%= typeof search !== 'undefined' && search ? '&search=' + encodeURIComponent(search) : '' %>" 
                   class="inline-flex items-center px-3 py-2 text-sm font-medium text-stone-700 bg-white border border-stone-400 rounded-lg hover:bg-stone-100 hover:text-stone-800 transition-colors duration-200">
                  <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M15 19l-7-7 7-7" />
                  </svg>
                  Previous
                </a>
              <% } %>
              
              <div class="flex space-x-1">
                <% 
                let startPage = Math.max(1, (typeof currentPage !== 'undefined' ? currentPage : 1) - 2);
                let endPage = Math.min(totalPages, (typeof currentPage !== 'undefined' ? currentPage : 1) + 2);
                
                for (let i = startPage; i <= endPage; i++) { %>
                  <% if (i === (typeof currentPage !== 'undefined' ? currentPage : 1)) { %>
                    <span class="inline-flex items-center px-3 py-2 text-sm font-medium bg-stone-600 text-white border-stone-600 border rounded-lg">
                      <%= i %>
                    </span>
                  <% } else { %>
                    <a href="?page=<%= i %><%= typeof search !== 'undefined' && search ? '&search=' + encodeURIComponent(search) : '' %>"
                       class="inline-flex items-center px-3 py-2 text-sm font-medium text-stone-700 bg-white border-stone-400 hover:bg-stone-100 border rounded-lg transition-colors duration-200">
                      <%= i %>
                    </a>
                  <% } %>
                <% } %>
              </div>
              
              <% if (typeof currentPage !== 'undefined' && currentPage < totalPages) { %>
                <a href="?page=<%= currentPage + 1 %><%= typeof search !== 'undefined' && search ? '&search=' + encodeURIComponent(search) : '' %>" 
                   class="inline-flex items-center px-3 py-2 text-sm font-medium text-stone-700 bg-white border border-stone-400 rounded-lg hover:bg-stone-100 hover:text-stone-800 transition-colors duration-200">
                  Next
                  <svg class="w-4 h-4 ml-1" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7" />
                  </svg>
                </a>
              <% } %>
            </nav>
          </div>
        </div>
        <% } %>
      </div>
    </main>
  </div>
</div>

<!-- Quick Status Update Modal (Hidden by default) -->
<div id="statusModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center">
  <div class="bg-white rounded-2xl shadow-2xl p-6 w-96 max-w-90vw">
    <h3 class="text-lg font-semibold text-gray-800 mb-4">Update Order Status</h3>
    <div class="space-y-4">
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-2">Order ID</label>
        <input type="text" id="modalOrderId" readonly class="w-full p-3 bg-gray-50 border border-stone-300 rounded-xl text-sm">
      </div>
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-2">New Status</label>
        <select id="modalStatusSelect" class="w-full p-3 border border-stone-300 rounded-xl focus:ring-2 focus:ring-stone-500 focus:border-transparent">
          <option value="Pending">Pending</option>
          <option value="Processing">Processing</option>
          <option value="Shipping">Shipping</option>
          <option value="Delivered">Delivered</option>
          <option value="Return Request">Return Request</option>
          <option value="Returned">Returned</option>
        </select>
      </div>
    </div>
    <div class="flex gap-3 mt-6">
      <button onclick="closeStatusModal()" class="flex-1 px-4 py-2 bg-gray-200 text-gray-800 rounded-xl hover:bg-gray-300 transition-colors">
        Cancel
      </button>
      <button onclick="confirmStatusUpdate()" class="flex-1 px-4 py-2 bg-gradient-to-r from-stone-600 to-stone-700 text-white rounded-xl hover:from-stone-700 hover:to-stone-800 transition-all duration-200">
        Update Status
      </button>
    </div>
  </div>
</div>

<script>
let currentOrderId = null;

// View Order Function - Redirect to detail page
function viewOrder(orderId) {
  window.location.href = `/admin/orders/detail/${orderId}`;
}

// Quick Status Update Function
function quickStatusUpdate(orderId, currentStatus) {
  currentOrderId = orderId;
  document.getElementById('modalOrderId').value = `#${orderId}`;
  document.getElementById('modalStatusSelect').value = currentStatus;
  document.getElementById('statusModal').classList.remove('hidden');
}

// Close Status Modal
function closeStatusModal() {
  document.getElementById('statusModal').classList.add('hidden');
  currentOrderId = null;
}

// Confirm Status Update
async function confirmStatusUpdate() {
  const newStatus = document.getElementById('modalStatusSelect').value;
  
  if (!currentOrderId || !newStatus) {
    return;
  }

  try {
    const button = document.querySelector('button[onclick="confirmStatusUpdate()"]');
    const originalText = button.innerHTML;
    button.innerHTML = `
      <svg class="animate-spin -ml-1 mr-2 h-4 w-4 text-white inline" fill="none" viewBox="0 0 24 24">
        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
      </svg>
      Updating...
    `;
    button.disabled = true;

    const response = await fetch('/admin/orders/update-status', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify({
        orderId: currentOrderId,
        status: newStatus
      })
    });

    const data = await response.json();

    if (data.success) {
      await Swal.fire({
        icon: 'success',
        title: 'Status Updated!',
        text: data.message,
        confirmButtonColor: '#059669',
        customClass: {
          popup: 'rounded-2xl',
          confirmButton: 'rounded-xl'
        }
      });

      // Reload the page to reflect changes
      window.location.reload();
      
    } else {
      throw new Error(data.message || 'Failed to update status');
    }
  } catch (error) {
    console.error('Error updating status:', error);
    await Swal.fire({
      icon: 'error',
      title: 'Update Failed',
      text: error.message || 'Something went wrong while updating the status',
      confirmButtonColor: '#dc2626',
      customClass: {
        popup: 'rounded-2xl',
        confirmButton: 'rounded-xl'
      }
    });
  } finally {
    // Restore button
    const button = document.querySelector('button[onclick="confirmStatusUpdate()"]');
    button.innerHTML = 'Update Status';
    button.disabled = false;
    closeStatusModal();
  }
}

// Refresh Orders Function
function refreshOrders() {
  window.location.reload();
}

// Close Success Alert
function closeAlert() {
  const alert = document.getElementById('successAlert');
  if (alert) {
    alert.style.opacity = '0';
    alert.style.transform = 'translateY(-10px)';
    setTimeout(() => {
      alert.remove();
    }, 300);
  }
}

// Calculate and display quick stats
function calculateStats() {
  const rows = document.querySelectorAll('tbody tr');
  let pending = 0, processing = 0, delivered = 0;
  
  rows.forEach(row => {
    const statusElement = row.querySelector('.status-badge');
    if (statusElement) {
      const statusText = statusElement.textContent.trim();
      if (statusText.includes('Pending')) pending++;
      else if (statusText.includes('Processing')) processing++;
      else if (statusText.includes('Delivered')) delivered++;
    }
  });
  
  document.getElementById('pendingCount').textContent = pending;
  document.getElementById('processingCount').textContent = processing;
  document.getElementById('deliveredCount').textContent = delivered;
}

// Search functionality
document.addEventListener('DOMContentLoaded', function() {
  // Calculate stats on page load
  calculateStats();

  // Auto-hide success message after 5 seconds
  const successAlert = document.getElementById('successAlert');
  if (successAlert) {
    setTimeout(() => {
      closeAlert();
    }, 5000);
  }

  const searchInput = document.querySelector('input[name="search"]');
  
  // Add search on Enter key
  if (searchInput) {
    searchInput.addEventListener('keypress', function(e) {
      if (e.key === 'Enter') {
        this.form.submit();
      }
    });
  }

  // Add loading states to search button
  const searchButton = document.querySelector('button[type="submit"]');
  if (searchButton) {
    searchButton.addEventListener('click', function() {
      this.innerHTML = `
        <svg class="animate-spin -ml-1 mr-2 h-4 w-4 text-white inline" fill="none" viewBox="0 0 24 24">
          <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
          <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
        </svg>
        Searching...
      `;
    });
  }

  // Add hover effects to customer avatars
  const customerAvatars = document.querySelectorAll('.w-12.h-12');
  customerAvatars.forEach(avatar => {
    avatar.addEventListener('mouseenter', function() {
      this.style.transform = 'scale(1.1) rotate(5deg)';
      this.style.transition = 'transform 0.2s ease';
    });
    
    avatar.addEventListener('mouseleave', function() {
      this.style.transform = 'scale(1) rotate(0deg)';
    });
  });

  // Add smooth scroll for pagination
  const paginationLinks = document.querySelectorAll('nav a');
  paginationLinks.forEach(link => {
    link.addEventListener('click', function() {
      window.scrollTo({ top: 0, behavior: 'smooth' });
    });
  });

  // Close modal when clicking outside
  document.getElementById('statusModal').addEventListener('click', function(e) {
    if (e.target === this) {
      closeStatusModal();
    }
  });

  // Keyboard shortcuts
  document.addEventListener('keydown', function(e) {
    // Escape key closes modal
    if (e.key === 'Escape' && !document.getElementById('statusModal').classList.contains('hidden')) {
      closeStatusModal();
    }
    
    // Ctrl/Cmd + R for refresh
    if ((e.ctrlKey || e.metaKey) && e.key === 'r') {
      e.preventDefault();
      refreshOrders();
    }
  });

  // Add tooltips for action buttons
  const actionButtons = document.querySelectorAll('.action-button');
  actionButtons.forEach(button => {
    button.addEventListener('mouseenter', function() {
      const tooltip = this.getAttribute('title');
      if (tooltip) {
        // You can implement custom tooltips here if needed
      }
    });
  });

  // Auto-refresh every 5 minutes (optional)
  // setInterval(refreshOrders, 300000);
});
</script>

</body>
</html>